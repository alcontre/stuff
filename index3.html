<!doctype html>
<style>
    :root {
        color-scheme: light dark;

        --myAAA-font: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        --myAAA-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

        --myAAA-radius: 12px;
        --myAAA-radius-sm: 10px;
        --myAAA-border: 1px solid rgba(0, 0, 0, 0.10);
        --myAAA-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        --myAAA-shadow-sm: 0 6px 16px rgba(0, 0, 0, 0.10);

        --myAAA-nav-width: 250px;

        --myAAA-bg: #f6f7fb;
        --myAAA-surface: #ffffff;
        --myAAA-surface-2: #f2f4f8;
        --myAAA-text: #0f172a;
        --myAAA-muted: rgba(15, 23, 42, 0.72);
        --myAAA-link: #2563eb;
        --myAAA-link-hover: #1d4ed8;
        --myAAA-accent: #2563eb;
        --myAAA-accent-weak: rgba(37, 99, 235, 0.10);

        /* Nav inherits the same theme surfaces (not forced dark) */
        --myAAA-nav-bg: var(--myAAA-surface);
        --myAAA-nav-border: var(--myAAA-border);
        --myAAA-nav-text: var(--myAAA-text);
        --myAAA-nav-muted: var(--myAAA-muted);
        --myAAA-nav-link: var(--myAAA-text);
        --myAAA-nav-link-hover: var(--myAAA-text);
        --myAAA-nav-hover-bg: rgba(15, 23, 42, 0.06);
        --myAAA-nav-divider: rgba(15, 23, 42, 0.10);
        --myAAA-nav-scroll-thumb: rgba(15, 23, 42, 0.18);
        --myAAA-nav-scroll-thumb-hover: rgba(15, 23, 42, 0.28);
        --myAAA-nav-btn-border: rgba(15, 23, 42, 0.14);
        --myAAA-nav-btn-bg: rgba(15, 23, 42, 0.05);
        --myAAA-nav-btn-bg-hover: rgba(15, 23, 42, 0.09);
        --myAAA-nav-arrow: rgba(15, 23, 42, 0.60);

        --myAAA-danger: #ef4444;
        --myAAA-danger-weak: rgba(239, 68, 68, 0.14);

        --myAAA-focus: 0 0 0 4px rgba(37, 99, 235, 0.25);
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --myAAA-bg: #070b14;
            --myAAA-surface: #0b1220;
            --myAAA-surface-2: #0f172a;
            --myAAA-text: rgba(255, 255, 255, 0.92);
            --myAAA-muted: rgba(255, 255, 255, 0.72);
            --myAAA-border: 1px solid rgba(255, 255, 255, 0.10);
            --myAAA-shadow: 0 10px 30px rgba(0, 0, 0, 0.50);
            --myAAA-shadow-sm: 0 6px 16px rgba(0, 0, 0, 0.55);

            --myAAA-link: #60a5fa;
            --myAAA-link-hover: #93c5fd;
            --myAAA-accent: #60a5fa;
            --myAAA-accent-weak: rgba(96, 165, 250, 0.16);

            --myAAA-nav-bg: var(--myAAA-surface);
            --myAAA-nav-border: var(--myAAA-border);
            --myAAA-danger: #f87171;
            --myAAA-danger-weak: rgba(248, 113, 113, 0.18);

            --myAAA-focus: 0 0 0 4px rgba(96, 165, 250, 0.25);

            --myAAA-nav-hover-bg: rgba(255, 255, 255, 0.08);
            --myAAA-nav-divider: rgba(255, 255, 255, 0.10);
            --myAAA-nav-scroll-thumb: rgba(255, 255, 255, 0.16);
            --myAAA-nav-scroll-thumb-hover: rgba(255, 255, 255, 0.24);
            --myAAA-nav-btn-border: rgba(255, 255, 255, 0.16);
            --myAAA-nav-btn-bg: rgba(255, 255, 255, 0.08);
            --myAAA-nav-btn-bg-hover: rgba(255, 255, 255, 0.14);
            --myAAA-nav-arrow: rgba(255, 255, 255, 0.65);
        }
    }

    html,
    body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: var(--myAAA-font);
        background: var(--myAAA-bg);
        color: var(--myAAA-text);
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
    }

    * {
        box-sizing: border-box;
    }

    .myAAAouter {
        position: relative;
    }

    .myAAAcontainer {
        display: grid;
        grid-template-columns: var(--myAAA-nav-width) 8px minmax(0, 1fr);
        align-items: start;
        min-height: 100vh;
        width: 100%;
        overflow: visible;
    }

    /* Visually hide the checkbox without moving it off-screen.
       If it's positioned far away, focusing it can scroll the page to the top. */
    #myAAANavToggle {
        position: sticky;
        top: 0.45rem;
        width: 1px;
        height: 1px;
        margin: 0.45rem 0 0 0.45rem;
        padding: 0;
        border: 0;
        opacity: 0;
        overflow: hidden;
        clip: rect(0 0 0 0);
        clip-path: inset(50%);
        white-space: nowrap;
        z-index: 19;
    }

    .myAAANavToggleLabel {
        position: sticky;
        top: 0.45rem;
        margin: 0.45rem 0 0 0.45rem;
        z-index: 20;
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
        padding: 0.26rem 0.5rem;
        border-radius: 999px;
        background: var(--myAAA-surface);
        color: var(--myAAA-text);
        border: var(--myAAA-border);
        cursor: pointer;
        box-shadow: var(--myAAA-shadow-sm);
        font-size: 0.9rem;
        font-weight: 600;
        width: max-content;
        user-select: none;
        backdrop-filter: blur(10px);
    }

    .myAAANavToggleLabel:hover {
        background: var(--myAAA-surface-2);
    }

    #myAAANavToggle:focus-visible+.myAAANavToggleLabel {
        outline: none;
        box-shadow: var(--myAAA-shadow-sm), var(--myAAA-focus);
    }

    .myAAANavToggleLabel .myAAAShowLabel {
        display: none;
    }

    #myAAANavToggle:checked+.myAAANavToggleLabel .myAAAHideLabel {
        display: none;
    }

    #myAAANavToggle:checked+.myAAANavToggleLabel .myAAAShowLabel {
        display: inline;
    }

    .myAAAcontainer nav {
        position: sticky;
        top: 0;
        max-height: 100vh;
        padding: 0.45rem;
        overflow-y: auto;
        background: var(--myAAA-nav-bg);
        color: var(--myAAA-nav-text);
        transition: transform 0.2s ease, opacity 0.2s ease;
    }

    .myAAAresizeGutter {
        position: sticky;
        top: 0;
        height: 100vh;
        cursor: ew-resize;
        background: var(--myAAA-nav-bg);
        border-right: var(--myAAA-nav-border);
        z-index: 10;
        transition: background 0.2s ease;
        user-select: none;
    }

    .myAAAresizeGutter:hover,
    .myAAAresizeGutter.active {
        background: var(--myAAA-accent);
    }

    .myAAAcontainer nav::-webkit-scrollbar {
        width: 10px;
    }

    .myAAAcontainer nav::-webkit-scrollbar-thumb {
        background: var(--myAAA-nav-scroll-thumb);
        border-radius: 999px;
        border: 2px solid transparent;
        background-clip: padding-box;
    }

    .myAAAcontainer nav::-webkit-scrollbar-thumb:hover {
        background: var(--myAAA-nav-scroll-thumb-hover);
        border: 2px solid transparent;
        background-clip: padding-box;
    }

    .myAAAcontainer nav h2 {
        margin: 0;
        font-size: 0.85rem;
        letter-spacing: 0.02em;
        text-transform: uppercase;
        color: var(--myAAA-nav-muted);
    }

    .myAAAcontainer nav a {
        color: var(--myAAA-nav-link);
        text-decoration: none;
        border-radius: 7px;
        padding: 0.12rem 0.25rem;
        display: inline-block;
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        line-height: 1.2;
    }

    .myAAAcontainer nav a:hover {
        color: var(--myAAA-nav-link-hover);
        background: var(--myAAA-nav-hover-bg);
    }

    .myAAAcontainer main {
        padding: 0.85rem;
        min-height: 100vh;
        overflow: visible;
    }

    /* Collapse nav when toggled off */
    #myAAANavToggle:checked~.myAAAcontainer {
        grid-template-columns: 0 0 minmax(0, 1fr);
    }

    #myAAANavToggle:checked~.myAAAcontainer nav {
        transform: translateX(-100%);
        opacity: 0;
        pointer-events: none;
    }

    #myAAANavToggle:checked~.myAAAcontainer .myAAAresizeGutter {
        transform: translateX(-100%);
        opacity: 0;
        pointer-events: none;
    }

    #myAAANavToggle:checked~.myAAAcontainer main {
        padding-left: 0.85rem;
    }

    .myAAAmainHeader {
        margin-bottom: 0.75rem;
        padding: 0.6rem 0.7rem;
        background: var(--myAAA-surface);
        border: var(--myAAA-border);
        border-radius: var(--myAAA-radius);
        box-shadow: var(--myAAA-shadow);
    }

    .myAAAcontainer main h1 {
        margin: 0 0 0.5rem 0;
        font-size: 1.2rem;
        line-height: 1.2;
        letter-spacing: -0.01em;
    }

    .myAAAmainControls,
    .myAAAnavControls {
        display: inline-flex;
        gap: 0.4rem;
        align-items: center;
    }

    .myAAAnavHeader {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        padding-bottom: 0.35rem;
        margin-bottom: 0.35rem;
        border-bottom: 1px solid var(--myAAA-nav-divider);
    }

    .myAAAcontainer button {
        font: inherit;
    }

    .myAAAnavControls button {
        padding: 0.22rem 0.4rem;
        border: 1px solid var(--myAAA-nav-btn-border);
        background: var(--myAAA-nav-btn-bg);
        color: var(--myAAA-nav-text);
        border-radius: 9px;
        cursor: pointer;
        line-height: 1;
        font-weight: 700;
    }

    .myAAAnavControls button:hover {
        background: var(--myAAA-nav-btn-bg-hover);
    }

    .myAAAmainControls button {
        padding: 0.24rem 0.45rem;
        border: var(--myAAA-border);
        background: var(--myAAA-surface-2);
        color: var(--myAAA-text);
        border-radius: 10px;
        cursor: pointer;
        font-weight: 600;
    }

    .myAAAmainControls button:hover {
        background: var(--myAAA-surface);
    }

    .myAAAmainControls button:focus-visible,
    .myAAAnavControls button:focus-visible {
        outline: none;
        box-shadow: var(--myAAA-focus);
    }

    .myAAAcontainer main details {
        margin: 0.3rem 0;
        padding: 0.18rem;
        border-radius: var(--myAAA-radius);
    }

    .myAAAcontainer main details[open] {
        background: var(--myAAA-surface);
        border: var(--myAAA-border);
        box-shadow: var(--myAAA-shadow);
        padding: 0.3rem 0.4rem;
    }

    .myAAAcontainer main details summary {
        cursor: pointer;
        font-weight: 650;
        padding: 0.28rem 0.35rem;
        list-style: none;
        border-radius: var(--myAAA-radius-sm);
        user-select: none;
    }

    .myAAAcontainer main details[open]>summary {
        background: var(--myAAA-accent-weak);
    }

    .myAAAcontainer main details summary:hover {
        background: var(--myAAA-surface-2);
    }

    .myAAAcontainer main details summary:focus-visible {
        outline: none;
        box-shadow: var(--myAAA-focus);
    }

    .myAAAcontainer main details summary {
        display: flex;
        align-items: center;
        gap: 0.4rem;
    }

    .myAAAcontainer main details summary span {
        display: inline;
        margin: 0;
        padding: 0;
        font-weight: 650;
        flex-grow: 1;
    }

    .myAAAcontainer main details summary .myAAAParentLink {
        font-size: 0.8rem;
        font-weight: 500;
        white-space: nowrap;
        flex-shrink: 0;
    }

    /* We use ::before rather than ::marker because confluence HTML Include
    appears to strip out ::marker */
    .myAAAcontainer main details summary::before {
        content: '▶ ';
        display: inline-block;
        width: 1em;
        text-align: center;
        font-family: var(--myAAA-mono);
        color: var(--myAAA-muted);
    }

    .myAAAcontainer main details[open]>summary::before {
        content: '▼ ';
    }

    .myAAAcontainer main details>*:not(summary) {
        margin-left: 0.75rem;
        color: var(--myAAA-muted);
        line-height: 1.45;
    }

    .myAAAcontainer main p {
        margin: 0.25rem 0;
    }

    .myAAAcontainer main table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-family: var(--myAAA-mono);
        font-size: 0.85rem;
        background: var(--myAAA-surface);
        border: var(--myAAA-border);
        border-radius: var(--myAAA-radius);
        overflow: hidden;
        margin: 0.5rem 0 0.2rem 0;
    }

    .myAAAcontainer main th,
    .myAAAcontainer main td {
        padding: 0.34rem 0.45rem;
        border: 0;
        border-right: var(--myAAA-border);
        border-bottom: var(--myAAA-border);
        vertical-align: top;
    }

    .myAAAcontainer main th:last-child,
    .myAAAcontainer main td:last-child {
        border-right: 0;
    }

    .myAAAcontainer main tbody tr:last-child td {
        border-bottom: 0;
    }

    .myAAAcontainer main thead th {
        border-top: 0;
        background: var(--myAAA-surface-2);
        color: var(--myAAA-text);
        text-align: left;
        font-weight: 700;
        letter-spacing: 0.01em;
    }

    .myAAAcontainer main td:nth-child(1) {
        white-space: nowrap;
        width: 6em;
        color: var(--myAAA-text);
        font-weight: 700;
    }

    .myAAAcontainer main td:nth-child(2) {
        white-space: pre;
        color: var(--myAAA-text);
    }

    .myAAAcontainer main td:nth-child(3) {
        color: var(--myAAA-muted);
    }

    .myAAAcontainer nav details {
        margin: 0.16rem 0;
    }

    /* The nav pane consists of summary/detail elements mirroring the main panel,
       and divs for leaf nodes (which do not have the ::before arrow) */
    .myAAAcontainer nav details summary,
    .myAAAcontainer nav div {
        cursor: pointer;
        font-weight: 600;
        padding: 0.1rem 0;
        list-style: none;
        color: var(--myAAA-nav-text);
    }

    /* Ensure the disclosure arrow and text are vertically centered */
    .myAAAcontainer nav details summary {
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    .myAAAcontainer nav a.active {
        color: var(--myAAA-nav-text);
        font-weight: 700;
        background: var(--myAAA-danger-weak);
        box-shadow: inset 0 0 0 1px var(--myAAA-nav-btn-border);
    }

    .myAAAcontainer nav details summary::before {
        content: '▶ ';
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 1em;
        min-width: 1em;
        text-align: center;
        font-family: var(--myAAA-mono);
        color: var(--myAAA-nav-arrow);
        line-height: 1;
        flex-shrink: 0;
    }

    .myAAAcontainer nav details[open]>summary::before {
        content: '▼ ';
    }

    /* Indentation for nested elements ("details") */
    .myAAAcontainer nav details>*:not(summary) {
        margin-left: 0.5em;
        border-left: 1px dashed var(--myAAA-nav-divider);
        padding-left: 0.5rem;
    }

    a {
        color: var(--myAAA-link);
    }

    a:hover {
        color: var(--myAAA-link-hover);
    }

    script {
        display: none;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const mainElement = document.querySelector('.myAAAcontainer main');

        // Number all sections recursively
        function numberSections(parent, prefix = '') {
            const childDetails = Array.from(parent.children).filter(child => child.tagName === 'DETAILS');

            childDetails.forEach((detail, index) => {
                const sectionNum = prefix ? `${prefix}-${index + 1}` : String(index + 1);
                const titleSpan = detail.querySelector(':scope > summary span');
                const titleText = titleSpan ? titleSpan.textContent.trim() : '';

                // Update ID
                detail.id = `myAAA${sectionNum}`;

                // Update span with section number
                if (titleSpan) {
                    titleSpan.textContent = `${sectionNum.replace(/-/g, '.')} ${titleText}`;
                }

                // Recursively number child sections
                numberSections(detail, sectionNum);
            });
        }

        // Number all sections first
        numberSections(mainElement);

        // Add "Jump to parent" links to all summary elements
        function addParentLinks() {
            const allDetails = Array.from(mainElement.querySelectorAll('details'));
            allDetails.forEach(detail => {
                const summary = detail.querySelector(':scope > summary');
                if (summary) {
                    // Check if this detail has a parent details element
                    let parentDetail = detail.parentElement ? detail.parentElement.closest('details') : null;
                    if (parentDetail && parentDetail.id) {
                        // Create the parent link
                        const parentLink = document.createElement('a');
                        parentLink.href = '#' + parentDetail.id;
                        parentLink.textContent = 'Jump to parent';
                        parentLink.className = 'myAAAParentLink';
                        summary.appendChild(parentLink);
                    }
                }
            });
        }

        addParentLinks();

        // Find all details elements in main and build nav
        function buildNav(parent, targetContainer) {
            const childDetails = Array.from(parent.children).filter(child => child.tagName === 'DETAILS');

            childDetails.forEach(detail => {
                const titleSpan = detail.querySelector(':scope > summary span');
                const id = detail.id;
                const text = titleSpan ? titleSpan.textContent : '';

                // Check if original detail has child details
                const nestedDetails = Array.from(detail.children).filter(child => child.tagName === 'DETAILS');

                if (nestedDetails.length > 0) {
                    // Parent node - create details element
                    const detailsNav = document.createElement('details');
                    const summaryNav = document.createElement('summary');
                    const link = document.createElement('a');

                    link.href = '#' + id;
                    link.textContent = text;
                    summaryNav.appendChild(link);
                    detailsNav.appendChild(summaryNav);
                    detailsNav.setAttribute('open', '');

                    // Recursively build nav for nested details
                    buildNav(detail, detailsNav);
                    targetContainer.appendChild(detailsNav);
                } else {
                    // Leaf node - just create a link in a div
                    const leafDiv = document.createElement('div');
                    const link = document.createElement('a');
                    link.href = '#' + id;
                    link.textContent = text;
                    leafDiv.appendChild(link);
                    targetContainer.appendChild(leafDiv);
                }
            });
        }

        // Build navigation from numbered sections
        const navContainer = document.createElement('div');
        navContainer.id = 'myAAAnavContainer';
        buildNav(mainElement, navContainer);

        // Insert the generated nav after the existing controls
        const navElement = document.querySelector('.myAAAcontainer nav');

        navElement.appendChild(navContainer);

        // Expand or collapse all details in nav
        function setNavDetailsState(open) {
            document.querySelectorAll('.myAAAcontainer nav details').forEach(d => {
                if (open) {
                    d.setAttribute('open', '');
                } else {
                    d.removeAttribute('open');
                }
            });
            highlightActiveLink();
        }

        const expandAllBtn = navElement.querySelector('#myAAAExpandAll');
        const collapseAllBtn = navElement.querySelector('#myAAACollapseAll');
        expandAllBtn.addEventListener('click', () => setNavDetailsState(true));
        collapseAllBtn.addEventListener('click', () => setNavDetailsState(false));

        // Expand or collapse all details in main pane
        function setMainDetailsState(open) {
            document.querySelectorAll('.myAAAcontainer main details').forEach(d => {
                if (open) {
                    d.setAttribute('open', '');
                } else {
                    d.removeAttribute('open');
                }
            });
            highlightActiveLink();
        }

        const mainExpandAllBtn = document.querySelector('#myAAAMainExpandAll');
        const mainCollapseAllBtn = document.querySelector('#myAAAMainCollapseAll');
        if (mainExpandAllBtn && mainCollapseAllBtn) {
            mainExpandAllBtn.addEventListener('click', () => setMainDetailsState(true));
            mainCollapseAllBtn.addEventListener('click', () => setMainDetailsState(false));
        }

        // Function to open a details element and all its parent details
        function openDetailsAndParents(element) {
            let current = element;
            while (current && current !== document.body) {
                if (current.tagName === 'DETAILS') {
                    current.setAttribute('open', '');
                }
                current = current.parentElement;
            }
        }

        // Handle hash navigation to expand collapsed details
        function handleHashChange() {
            const hash = window.location.hash;
            if (hash) {
                const target = document.querySelector(hash);
                if (target) {
                    openDetailsAndParents(target);
                    setActiveDetail(target);
                    highlightActiveLink();
                }
            }
        }

        // Scroll tracking to highlight active section in nav
        const mainDetails = Array.from(document.querySelectorAll('.myAAAcontainer main details'));

        function isContentDetailVisible(detail) {
            if (!detail) return false;
            let current = detail.parentElement;
            while (current && current !== document.body) {
                if (current.tagName === 'DETAILS' && !current.open) {
                    return false; // Hidden by a collapsed ancestor
                }
                current = current.parentElement;
            }
            return true;
        }

        // Nav links can be inside <summary> (always visible) or inside the details body (hidden when closed).
        function isNavLinkVisible(linkEl) {
            if (!linkEl) return false;
            let current = linkEl;
            while (current && current !== document.body) {
                if (current.tagName === 'DETAILS') {
                    const summary = current.querySelector(':scope > summary');
                    // If the original link lives in this <details>'s <summary>, this <details>'s open state
                    // does not affect its visibility.
                    if (!summary || !summary.contains(linkEl)) {
                        if (!current.open) return false;
                    }
                }
                current = current.parentElement;
            }
            return true;
        }

        // Returns the first visible nav link by climbing the nav tree (not the content tree)
        function findVisibleNavLink(detail) {
            let currentLink = document.querySelector(`.myAAAcontainer nav a[href="#${detail.id}"]`);
            while (currentLink) {
                if (isNavLinkVisible(currentLink)) {
                    return currentLink;
                }

                const currentDetails = currentLink.closest('details');
                if (!currentDetails) break;

                // First, try the current <details>' own summary link (the nearest parent section).
                const currentSummaryLink = currentDetails.querySelector(':scope > summary a');
                if (currentSummaryLink && currentSummaryLink !== currentLink) {
                    currentLink = currentSummaryLink;
                    continue;
                }

                // Otherwise climb to the next ancestor <details>.
                const parentDetails = currentDetails.parentElement ? currentDetails.parentElement.closest('details') : null;
                currentLink = parentDetails ? parentDetails.querySelector(':scope > summary a') : null;
            }
            return null;
        }

        let activeDetail = null;
        function setActiveDetail(detail) {
            if (!detail || !detail.id) return;
            if (activeDetail && activeDetail.id === detail.id) return;
            activeDetail = detail;
        }

        // Use IntersectionObserver so we don't scan every <details> on every scroll.
        // We observe the <summary> nodes (the "headers") and maintain a small candidate set.
        const activeCandidates = new Map(); // id -> { detail, top }
        const mainSummaries = Array.from(document.querySelectorAll('.myAAAcontainer main details > summary'));

        function updateActiveFromCandidates() {
            let best = null;
            for (const candidate of activeCandidates.values()) {
                if (!best || candidate.top > best.top) {
                    best = candidate;
                }
            }
            if (best) {
                setActiveDetail(best.detail);
            }
            highlightActiveLink();
        }

        const summaryObserver = new IntersectionObserver(
            (entries) => {
                for (const entry of entries) {
                    const summaryEl = entry.target;
                    const detail = summaryEl.parentElement;
                    if (!detail || !detail.id) continue;

                    if (entry.isIntersecting && isContentDetailVisible(detail)) {
                        activeCandidates.set(detail.id, { detail, top: entry.boundingClientRect.top });
                    } else {
                        activeCandidates.delete(detail.id);
                    }
                }
                updateActiveFromCandidates();
            },
            {
                root: null,
                threshold: 0,
                // Shrink the root so intersections only happen in a thin band at the top.
                // This keeps the activeCandidates set small even for huge documents.
                rootMargin: '0px 0px -95% 0px'
            }
        );

        mainSummaries.forEach(summary => summaryObserver.observe(summary));

        function highlightActiveLink() {
            const navLinks = document.querySelectorAll('.myAAAcontainer nav a');
            navLinks.forEach(link => link.classList.remove('active'));

            if (activeDetail && activeDetail.id) {
                const activeLink = findVisibleNavLink(activeDetail);
                if (activeLink) activeLink.classList.add('active');
            }
        }

        // Listen for hash changes after scroll/highlight utilities are ready
        window.addEventListener('hashchange', handleHashChange);

        // Handle initial hash on page load
        handleHashChange();
        // If there's no hash, set an initial active section once the observer has a chance to run.
        window.requestAnimationFrame(() => updateActiveFromCandidates());

        // Add resize functionality (gutter lives outside the scrollable nav)
        const resizeGutter = document.querySelector('.myAAAresizeGutter');

        let isResizing = false;
        let startX = 0;
        let startWidth = 0;

        if (resizeGutter) resizeGutter.addEventListener('mousedown', (e) => {
            isResizing = true;
            startX = e.clientX;
            const raw = getComputedStyle(document.documentElement).getPropertyValue('--myAAA-nav-width');
            const parsed = parseFloat(raw);
            startWidth = Number.isFinite(parsed) ? parsed : navElement.getBoundingClientRect().width;
            resizeGutter.classList.add('active');
            document.body.style.cursor = 'ew-resize';
            document.body.style.userSelect = 'none';
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;

            const deltaX = e.clientX - startX;
            const newWidth = Math.max(150, Math.min(600, startWidth + deltaX));
            document.documentElement.style.setProperty('--myAAA-nav-width', `${newWidth}px`);
        });

        document.addEventListener('mouseup', () => {
            if (isResizing) {
                isResizing = false;
                if (resizeGutter) resizeGutter.classList.remove('active');
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
            }
        });

    });
</script>
<div class="myAAAouter">
    <input type="checkbox" id="myAAANavToggle" aria-label="Toggle navigation" />
    <label class="myAAANavToggleLabel" for="myAAANavToggle">
        <span class="myAAAHideLabel">Hide nav</span>
        <span class="myAAAShowLabel">Show nav</span>
    </label>
    <div class="myAAAcontainer">
        <nav aria-label="Navigation">
            <div class="myAAAnavHeader">
                <h2>Navigation</h2>
                <div class="myAAAnavControls">
                    <button type="button" id="myAAAExpandAll">+</button>
                    <button type="button" id="myAAACollapseAll">-</button>
                </div>
            </div>
        </nav>

        <div class="myAAAresizeGutter" role="separator" aria-orientation="vertical" aria-label="Resize navigation"></div>

        <main>
            <div class="myAAAmainHeader">
                <h1>Binary Data Format Description</h1>
                <div class="myAAAmainControls">
                    <button type="button" id="myAAAMainExpandAll">Expand all</button>
                    <button type="button" id="myAAAMainCollapseAll">Collapse all</button>
                </div>
            </div>
            <details open>
                <summary><span>File Header</span></summary>
                <p>The file header contains metadata about the binary format structure and version.</p>

                <table>
                    <thead>
                        <tr>
                            <th>Word</th>
                            <th>Bitfield</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Word 0</td>
                            <td>|31..24|23..16|15..08|07..00|</td>
                            <td>Format sync + version + feature flags.</td>
                        </tr>
                        <tr>
                            <td>Word 1</td>
                            <td>|31.................16|15.................00|</td>
                            <td>Total header size in bytes; remainder reserved.</td>
                        </tr>
                        <tr>
                            <td>Word 2</td>
                            <td>|31.......................................00| </td>
                            <td>Absolute byte offset to the chunk table.</td>
                        </tr>
                        <tr>
                            <td>Word 3</td>
                            <td>|31.................16|15.................00| </td>
                            <td>Number of chunk entries and the per-entry size.</td>
                        </tr>
                    </tbody>
                </table>

                <details open>
                    <summary><span>Signature</span></summary>
                    <p>Magic bytes indicating format identity.</p>
                </details>

                <details open>
                    <summary><span>Version</span></summary>
                    <p>16-bit integer identifying schema revision.</p>
                </details>
            </details>

            <details open>
                <summary><span>Chunk Table</span></summary>
                <p>The chunk table provides an index of all data chunks within the file.</p>

                <details open>
                    <summary><span>Chunk Entry</span></summary>
                    <p>Repeated entries describing each payload chunk.</p>

                    <details open>
                        <summary><span>Chunk Type</span></summary>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                        <p>Enumerated value describing purpose.</p>
                    </details>

                    <details open>
                        <summary><span>Chunk Offset</span></summary>
                        <p>32-bit offset from file start.</p>
                        <details open>
                            <summary><span>Chunk Offset</span></summary>
                            <p>32-bit offset from file start.</p>
                            <details open>
                                <summary><span>Chunk Offset</span></summary>
                                <p>32-bit offset from file start.</p>
                            </details>
                        </details>
                    </details>

                    <details open>
                        <summary><span>Chunk Size</span></summary>
                        <p>32-bit length in bytes.</p>
                    </details>
                </details>
            </details>

            <details open>
                <summary><span>Payload</span></summary>
                <p>The payload section contains the actual data content organized into structured blocks.</p>

                <details open>
                    <summary><span>Metadata Block</span></summary>
                    <p>Optional key/value pairs with UTF-8 strings.</p>
                </details>

                <details open>
                    <summary><span>Data Block</span></summary>
                    <p>One or more records of the primary content.</p>

                    <details open>
                        <summary><span>Record Header</span></summary>
                        <p>Flags and length for each record.</p>
                    </details>

                    <details open>
                        <summary><span>Record Body</span></summary>
                        <p>Raw bytes interpreted per chunk type.</p>
                    </details>
                </details>
            </details>
        </main>
    </div>
</div>